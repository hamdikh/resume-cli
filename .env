import os
import json

def read_json_file(file_path):
    with open(file_path, 'r') as file:
        return json.load(file)

def process_cluster(cluster_path):
    cluster_json_path = os.path.join(cluster_path, 'cluste.json')
    if os.path.exists(cluster_json_path):
        cluster_data = read_json_file(cluster_json_path)
        return cluster_data
    return {}

def process_project(project_path, subscription_data):
    project_json_path = os.path.join(project_path, 'project.json')
    if os.path.exists(project_json_path):
        project_data = read_json_file(project_json_path)
        clusters = []
        clusters_dir = os.path.join(project_path, 'clusters')
        if os.path.exists(clusters_dir):
            for cluster_name in os.listdir(clusters_dir):
                cluster_path = os.path.join(clusters_dir, cluster_name)
                if os.path.isdir(cluster_path):
                    cluster_data = process_cluster(cluster_path)
                    if cluster_data:
                        clusters.append(cluster_data)
        project_data['clusters'] = clusters
        # Merge subscription data into project data
        project_data.update(subscription_data)
        return project_data
    return {}

def process_subscription(subscription_path):
    subscription_json_path = os.path.join(subscription_path, 'subscription.json')
    if os.path.exists(subscription_json_path):
        subscription_data = read_json_file(subscription_json_path)
        projects = []
        for project_name in os.listdir(subscription_path):
            project_path = os.path.join(subscription_path, project_name)
            if os.path.isdir(project_path):
                project_data = process_project(project_path, subscription_data)
                if project_data:
                    projects.append(project_data)
        return projects
    return []

def main(subscriptions_root_path):
    projects = []
    for subscription_name in os.listdir(subscriptions_root_path):
        subscription_path = os.path.join(subscriptions_root_path, subscription_name)
        if os.path.isdir(subscription_path):
            projects.extend(process_subscription(subscription_path))
    
    combined_data = {'projects': projects}
    with open('combined_data.json', 'w') as output_file:
        json.dump(combined_data, output_file, indent=4)

if __name__ == '__main__':
    subscriptions_root_path = 'path_to_subscriptions_folder'  # Replace with the actual path to the subscriptions folder
    main(subscriptions_root_path)